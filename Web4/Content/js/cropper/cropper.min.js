/*!
 * Cropper v0.5.5
 * https://github.com/fengyuanchen/cropper
 *
 * Copyright 2014 Fengyuan Chen
 * Released under the MIT license
 */
(function(n){typeof define=="function"&&define.amd?define(["jquery"],n):n(jQuery)})(function(n){"use strict";var a=n(window),k=n(document),d=/^(\+|\*|e|n|w|s|ne|nw|sw|se)$/i,g=/^(x|y|width|height)$/i,r="cropper-hidden",v="cropper-invisible",y="mousedown touchstart",p="mousemove touchmove",w="mouseup mouseleave touchend touchleave touchcancel",s="build.cropper",h="built.cropper",c="render.cropper",b="resize.cropper",u=function(n){return typeof n=="number"},i=function(t,i){this.$element=n(t);this.setDefaults(i);this.init()},t=Math.round,f=Math.min,o=Math.max,l=Math.abs,e=parseFloat;i.prototype={constructor:i,setDefaults:function(t){t=n.extend({},i.defaults,n.isPlainObject(t)?t:{});n.each(t,function(n,i){switch(n){case"moveable":t.movable=i;break;case"resizeable":t.resizable=i;break;case"aspectRatio":t[n]=l(e(i))||NaN;break;case"minWidth":case"minHeight":t[n]=l(e(i))||0;break;case"maxWidth":case"maxHeight":t[n]=l(e(i))||Infinity}});this.defaults=t},init:function(){var u=this,f=this.$element,e=f[0],t={},i,r;if(f.is("img")?i=f.attr("src"):f.is("canvas")&&e.getContext&&(i=e.toDataURL()),i){this.$clone&&this.$clone.remove();this.$clone=r=n('<img src="'+i+'">');r.one("load",function(){t.naturalWidth=this.naturalWidth||r.width();t.naturalHeight=this.naturalHeight||r.height();t.aspectRatio=t.naturalWidth/t.naturalHeight;u.active=!0;u.src=i;u.image=t;u.build()});r.addClass(v).prependTo("body")}},build:function(){var f=this.$element,u=this.defaults,e,t;(this.built&&this.unbuild(),e=n.Event(s),f.trigger(e),e.isDefaultPrevented())||(this.$cropper=t=n(i.template),f.addClass(r),this.$clone.removeClass(v).prependTo(t),this.$container=f.parent(),this.$container.append(t),this.$modal=t.find(".cropper-modal"),this.$canvas=t.find(".cropper-canvas"),this.$dragger=t.find(".cropper-dragger"),this.$viewer=t.find(".cropper-viewer"),this.cropped=!0,u.autoCrop||(this.$dragger.addClass(r),this.cropped=!1),this.$modal.toggleClass(r,!u.modal),u.dragCrop||this.$canvas.addClass(r),u.movable||this.$dragger.find(".cropper-face").addClass(r),u.resizable||this.$dragger.find(".cropper-line, .cropper-point").addClass(r),this.$dragScope=u.multiple?this.$cropper:k,this.addListener(),this.initPreview(),this.built=!0,this.update(),f.trigger(h))},unbuild:function(){this.built&&(this.built=!1,this.removeListener(),this.$preview.empty(),this.$preview=null,this.$dragger=null,this.$canvas=null,this.$modal=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},update:function(n){this.initContainer();this.initCropper();this.initDragger();n?this.setData(n,!0):this.setData(this.defaults.data)},resize:function(){clearTimeout(this.resizing);this.resizing=setTimeout(n.proxy(this.update,this,this.getData()),200)},reset:function(n){this.cropped&&(n&&(this.defaults.data={}),this.dragger=this.cloneDragger(),this.setData(this.defaults.data))},release:function(){this.cropped&&(this.cropped=!1,this.defaults.done({x:0,y:0,width:0,height:0}),this.$dragger.addClass(r))},destroy:function(){var n=this.$element;this.active&&(this.unbuild(),n.removeClass(r),n.removeData("cropper"),n=null)},preview:function(){var r=this.cropper,i=this.dragger;this.$viewer.find("img").css({height:t(r.height),marginLeft:-t(i.left),marginTop:-t(i.top),width:t(r.width)});this.$preview.each(function(){var f=n(this),u=f.width()/i.width,e={height:t(r.height*u),marginLeft:-t(i.left*u),marginTop:-t(i.top*u),width:t(r.width*u)};f.find("img").css(e)})},addListener:function(){var t=this.defaults;this.$element.on(s,t.build).on(h,t.built).on(c,t.render);this.$cropper.on(y,n.proxy(this.dragstart,this));this.$dragScope.on(p,n.proxy(this.dragmove,this)).on(w,n.proxy(this.dragend,this));a.on(b,n.proxy(this.resize,this))},removeListener:function(){var n=this.defaults;this.$element.off(s,n.build).off(h,n.built).off(c,n.render);this.$cropper.off(y,this.dragstart);this.$dragScope.off(p,this.dragmove).on(w,this.dragend);a.off(b,this.resize)},initPreview:function(){var t='<img src="'+this.src+'">';this.$preview=n(this.defaults.preview);this.$preview.html(t);this.$viewer.html(t)},initContainer:function(){var n=this.$container;this.container={width:n.width(),height:n.height()}},initCropper:function(){var i=this.container,r=this.image,n;r.naturalWidth*i.height/r.naturalHeight-i.width>=0?(n={height:i.width/r.aspectRatio,width:i.width,left:0},n.top=(i.height-n.height)/2):(n={height:i.height,width:i.height*r.aspectRatio,top:0},n.left=(i.width-n.width)/2);r.ratio=n.width/r.naturalWidth;r.height=n.height;r.width=n.width;this.$cropper.css({height:t(n.height),left:t(n.left),top:t(n.top),width:t(n.width)});this.cropper=n},initDragger:function(){var i=this.defaults,t=this.cropper,r=i.aspectRatio||this.image.aspectRatio,u=this.image.ratio,n;n=t.height*r-t.width>=0?{height:t.width/r,width:t.width,left:0,top:(t.height-t.width/r)/2,maxWidth:t.width,maxHeight:t.width/r}:{height:t.height,width:t.height*r,left:(t.width-t.height*r)/2,top:0,maxWidth:t.height*r,maxHeight:t.height};n.minWidth=0;n.minHeight=0;i.aspectRatio?(isFinite(i.maxWidth)?(n.maxWidth=f(n.maxWidth,i.maxWidth*u),n.maxHeight=n.maxWidth/r):isFinite(i.maxHeight)&&(n.maxHeight=f(n.maxHeight,i.maxHeight*u),n.maxWidth=n.maxHeight*r),i.minWidth>0?(n.minWidth=o(0,i.minWidth*u),n.minHeight=n.minWidth/r):i.minHeight>0&&(n.minHeight=o(0,i.minHeight*u),n.minWidth=n.minHeight*r)):(n.maxWidth=f(n.maxWidth,i.maxWidth*u),n.maxHeight=f(n.maxHeight,i.maxHeight*u),n.minWidth=o(0,i.minWidth*u),n.minHeight=o(0,i.minHeight*u));n.minWidth=f(n.maxWidth,n.minWidth);n.minHeight=f(n.maxHeight,n.minHeight);n.height*=.8;n.width*=.8;n.left=(t.width-n.width)/2;n.top=(t.height-n.height)/2;this.defaultDragger=n;this.dragger=this.cloneDragger();this.draggerLeft=n.left;this.draggerTop=n.top},cloneDragger:function(){return n.extend({},this.defaultDragger)},renderDragger:function(){var i=this.dragger,e=this.cropper,o=this.draggerLeft,s=this.draggerTop,r,u,f;(i.width>i.maxWidth?(i.width=i.maxWidth,i.left=o):i.width<i.minWidth&&(i.width=i.minWidth,i.left=o),i.height>i.maxHeight?(i.height=i.maxHeight,i.top=s):i.height<i.minHeight&&(i.height=i.minHeight,i.top=s),r=e.width-i.width,u=e.height-i.height,i.left=i.left>r?r:i.left<0?0:i.left,i.top=i.top>u?u:i.top<0?0:i.top,f=n.Event(c),this.$element.trigger(f),f.isDefaultPrevented())||(this.dragger=i,this.draggerLeft=i.left,this.draggerTop=i.top,this.defaults.done(this.getData()),this.$dragger.css({height:t(i.height),left:t(i.left),top:t(i.top),width:t(i.width)}),this.preview())},setData:function(t,i){var e=this.cropper,r=this.dragger,f=this.defaults.aspectRatio;this.built&&typeof t!="undefined"&&((t===null||n.isEmptyObject(t))&&(r=this.cloneDragger()),n.isPlainObject(t)&&!n.isEmptyObject(t)&&(i||(this.defaults.data=t),t=this.transformData(t),u(t.x)&&t.x<=e.width&&(r.left=t.x),u(t.y)&&t.y<=e.height&&(r.top=t.y),f?u(t.width)&&t.width<=r.maxWidth&&t.width>=r.minWidth?(r.width=t.width,r.height=r.width/f):u(t.height)&&t.height<=r.maxHeight&&t.height>=r.minHeight&&(r.height=t.height,r.width=r.height*f):(u(t.width)&&t.width<=r.maxWidth&&t.width>=r.minWidth&&(r.width=t.width),u(t.height)&&t.height<=r.maxHeight&&t.height>=r.minHeight&&(r.height=t.height))),this.dragger=r,this.renderDragger())},getData:function(){var n=this.dragger,t={};return this.built&&(t={x:n.left,y:n.top,width:n.width,height:n.height},t=this.transformData(t,!0)),t},transformData:function(i,r){var u=this.image.ratio,f={};return n.each(i,function(n,i){i=e(i);g.test(n)&&!isNaN(i)&&(f[n]=r?t(i/u):i*u)}),f},setAspectRatio:function(n){var t=n==="auto";n=e(n);(t||!isNaN(n)&&n>0)&&(this.defaults.aspectRatio=t?NaN:n,this.built&&(this.initDragger(),this.renderDragger()))},setImgSrc:function(t){var f=this,r=this.$element,i=r[0],u;if(t&&t!==this.src)if(r.is("img"))r.attr("src",t),this.init();else if(r.is("canvas")&&i.getContext){u=i.getContext("2d");n('<img src="'+t+'">').one("load",function(){i.width=this.width;i.height=this.height;u.clearRect(0,0,i.width,i.height);u.drawImage(this,0,0);f.init()})}},getImgInfo:function(){return this.image||{}},dragstart:function(t){var f=(t.originalEvent||t).touches,i=t,u;if(f){if(f.length>1)return;i=f[0];this.touchId=i.identifier}u=n(i.target).data("direction");d.test(u)&&(t.preventDefault(),this.direction=u,this.startX=i.pageX,this.startY=i.pageY,u==="+"&&(this.cropping=!0,this.$modal.removeClass(r)))},dragmove:function(n){var i=(n.originalEvent||n).changedTouches,t=n;if(i){if(i.length>1)return;if(t=i[0],t.identifier!==this.touchId)return}this.direction&&(n.preventDefault(),this.endX=t.pageX,this.endY=t.pageY,this.dragging())},dragend:function(n){var t=(n.originalEvent||n).changedTouches,i=n;if(t){if(t.length>1)return;if(i=t[0],i.identifier!==this.touchId)return}this.direction&&(n.preventDefault(),this.cropping&&(this.cropping=!1,this.$modal.toggleClass(r,!this.defaults.modal)),this.direction="")},dragging:function(){var o=this.direction,p=this.cropper,c=p.width,l=p.height,s=this.dragger,t=s.width,i=s.height,f=s.left,e=s.top,a=f+t,v=e+i,h=!0,u=this.defaults.aspectRatio,n={x:this.endX-this.startX,y:this.endY-this.startY},y;u&&(n.X=n.y*u,n.Y=n.x/u);switch(o){case"+":n.x&&n.y&&(y=this.$cropper.offset(),f=this.startX-y.left,e=this.startY-y.top,t=s.minWidth,i=s.minHeight,n.x>0?n.y>0?o="se":(o="ne",e-=i):n.y>0?(o="sw",f-=t):(o="nw",f-=t,e-=i),this.cropped||(this.cropped=!0,this.$dragger.removeClass(r)));break;case"*":f+=n.x;e+=n.y;break;case"e":if(n.x>=0&&(a>=c||u&&(e<=0||v>=l))){h=!1;break}t+=n.x;u&&(i=t/u,e-=n.Y/2);t<0&&(o="w",t=0);break;case"n":if(n.y<=0&&(e<=0||u&&(f<=0||a>=c))){h=!1;break}i-=n.y;e+=n.y;u&&(t=i*u,f+=n.X/2);i<0&&(o="s",i=0);break;case"w":if(n.x<=0&&(f<=0||u&&(e<=0||v>=l))){h=!1;break}t-=n.x;f+=n.x;u&&(i=t/u,e+=n.Y/2);t<0&&(o="e",t=0);break;case"s":if(n.y>=0&&(v>=l||u&&(f<=0||a>=c))){h=!1;break}i+=n.y;u&&(t=i*u,f-=n.X/2);i<0&&(o="n",i=0);break;case"ne":if(n.y<=0&&(e<=0||a>=c)){h=!1;break}i-=n.y;e+=n.y;u?t=i*u:t+=n.x;i<0&&(o="sw",i=0,t=0);break;case"nw":if(n.y<=0&&(e<=0||f<=0)){h=!1;break}i-=n.y;e+=n.y;u?(t=i*u,f+=n.X):(t-=n.x,f+=n.x);i<0&&(o="se",i=0,t=0);break;case"sw":if(n.x<=0&&(f<=0||v>=l)){h=!1;break}t-=n.x;f+=n.x;u?i=t/u:i+=n.y;t<0&&(o="ne",i=0,t=0);break;case"se":if(n.x>=0&&(a>=c||v>=l)){h=!1;break}t+=n.x;u?i=t/u:i+=n.y;t<0&&(o="nw",i=0,t=0)}h&&(s.width=t,s.height=i,s.left=f,s.top=e,this.direction=o,this.renderDragger());this.startX=this.endX;this.startY=this.endY}};i.template=function(n,t){return t=t.split(","),n.replace(/\d+/g,function(n){return t[n]})}('<0 6="5-container"><0 6="5-modal"><\/0><0 6="5-canvas" 3-2="+"><\/0><0 6="5-dragger"><1 6="5-viewer"><\/1><1 6="5-8 8-h"><\/1><1 6="5-8 8-v"><\/1><1 6="5-face" 3-2="*"><\/1><1 6="5-7 7-e" 3-2="e"><\/1><1 6="5-7 7-n" 3-2="n"><\/1><1 6="5-7 7-w" 3-2="w"><\/1><1 6="5-7 7-s" 3-2="s"><\/1><1 6="5-4 4-e" 3-2="e"><\/1><1 6="5-4 4-n" 3-2="n"><\/1><1 6="5-4 4-w" 3-2="w"><\/1><1 6="5-4 4-s" 3-2="s"><\/1><1 6="5-4 4-ne" 3-2="ne"><\/1><1 6="5-4 4-nw" 3-2="nw"><\/1><1 6="5-4 4-sw" 3-2="sw"><\/1><1 6="5-4 4-se" 3-2="se"><\/1><\/0><\/0>',"div,span,direction,data,point,cropper,class,line,dashed");i.defaults={aspectRatio:"auto",data:{},done:n.noop,multiple:!1,autoCrop:!0,dragCrop:!0,modal:!0,movable:!0,resizable:!0,minWidth:0,minHeight:0,maxWidth:Infinity,maxHeight:Infinity};i.setDefaults=function(t){n.extend(i.defaults,t)};i.other=n.fn.cropper;n.fn.cropper=function(t,r){var u=this;return this.each(function(){var e=n(this),f=e.data("cropper");f||e.data("cropper",f=new i(this,t));typeof t=="string"&&n.isFunction(f[t])&&(u=f[t](r))}),typeof u!="undefined"?u:this};n.fn.cropper.constructor=i;n.fn.cropper.setDefaults=i.setDefaults;n.fn.cropper.noConflict=function(){return n.fn.cropper=i.other,this}});
//# sourceMappingURL=cropper.min.js.map
