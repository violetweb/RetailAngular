/*! UIkit 2.10.0 | http://www.getuikit.com | (c) 2014 YOOtheme | MIT License */
(function(n){var t;jQuery&&jQuery.UIkit&&(t=n(jQuery,jQuery.UIkit));typeof define=="function"&&define.amd&&define("uikit-nestable",["uikit"],function(){return t||n(jQuery,jQuery.UIkit)})})(function(n,t){var i="ontouchstart"in window,u=n("html"),r=[],f=t.$win,e=function(){var n=document.createElement("div"),t=document.documentElement,i;return("pointerEvents"in n.style)?(n.style.pointerEvents="auto",n.style.pointerEvents="x",t.appendChild(n),i=window.getComputedStyle&&window.getComputedStyle(n,"").pointerEvents==="auto",t.removeChild(n),!!i):!1}(),o=i?"touchstart":"mousedown",s=i?"touchmove":"mousemove",h=i?"touchend":"mouseup",c=i?"touchcancel":"mouseup";return t.component("nestable",{defaults:{prefix:"uk",listNodeName:"ul",itemNodeName:"li",listBaseClass:"{prefix}-nestable",listClass:"{prefix}-nestable-list",listitemClass:"{prefix}-nestable-list-item",itemClass:"{prefix}-nestable-item",dragClass:"{prefix}-nestable-list-dragged",movingClass:"{prefix}-nestable-moving",handleClass:"{prefix}-nestable-handle",collapsedClass:"{prefix}-collapsed",placeClass:"{prefix}-nestable-placeholder",noDragClass:"{prefix}-nestable-nodrag",emptyClass:"{prefix}-nestable-empty",group:0,maxDepth:10,threshold:20},init:function(){var t=this;Object.keys(this.options).forEach(function(n){String(t.options[n]).indexOf("{prefix}")!=-1&&(t.options[n]=t.options[n].replace("{prefix}",t.options.prefix))});this.tplempty='<div class="'+this.options.emptyClass+'"/>';this.find(">"+this.options.itemNodeName).addClass(this.options.listitemClass).end().find("ul:not(.ignore-list)").addClass(this.options.listClass).find(">li").addClass(this.options.listitemClass);this.element.children(this.options.itemNodeName).length||this.element.append(this.tplempty);this.element.data("nestable-id","ID"+(new Date).getTime()+"RAND"+Math.ceil(Math.random()*1e5));this.reset();this.element.data("nestable-group",this.options.group);this.placeEl=n('<div class="'+this.options.placeClass+'"/>');this.find(this.options.itemNodeName).each(function(){t.setParent(n(this))});this.on("click","[data-nestable-action]",function(r){if(!t.dragEl&&(i||r.button===0)){r.preventDefault();var e=n(r.currentTarget),u=e.data("nestableAction"),f=e.closest(t.options.itemNodeName);u==="collapse"&&t.collapseItem(f);u==="expand"&&t.expandItem(f);u==="toggle"&&t.toggleItem(f)}});var u=function(r){var u=n(r.target);if(!u.hasClass(t.options.handleClass)){if(u.closest("."+t.options.noDragClass).length)return;u=u.closest("."+t.options.handleClass)}u.length&&!t.dragEl&&(i||r.button===0)&&(!i||r.touches.length===1)&&(r.preventDefault(),t.dragStart(i?r.touches[0]:r),t.trigger("nestable-start",[t]))},e=function(n){t.dragEl&&(n.preventDefault(),t.dragMove(i?n.touches[0]:n),t.trigger("nestable-move",[t]))},r=function(n){t.dragEl&&(n.preventDefault(),t.dragStop(i?n.touches[0]:n),t.trigger("nestable-stop",[t]))};if(i)this.element[0].addEventListener(o,u,!1),window.addEventListener(s,e,!1),window.addEventListener(h,r,!1),window.addEventListener(c,r,!1);else{this.on(o,u);f.on(s,e);f.on(h,r)}},serialize:function(){var t=this;return step=function(i,r){var u=[],f=i.children(t.options.itemNodeName);return f.each(function(){var i=n(this),f=n.extend({},i.data()),e=i.children(t.options.listNodeName);e.length&&(f.children=step(e,r+1));u.push(f)}),u},step(t.element,0)},list:function(t){var i=[],r=this,t=n.extend({},r.options,t),u=function(r,f,e){var o=r.children(t.itemNodeName);o.each(function(r){var o=n(this),h=n.extend({parent_id:e?e:null,depth:f,order:r},o.data()),s=o.children(t.listNodeName);i.push(h);s.length&&u(s,f+1,o.data(t.idProperty||"id"))})};return u(r.element,0),i},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0};this.moving=!1;this.dragEl=null;this.dragRootEl=null;this.dragDepth=0;this.hasNewRoot=!1;this.pointEl=null;for(var n=0;n<r.length;n++)r[n].children().length||r[n].append(this.tplempty);r=[]},toggleItem:function(n){this[n.hasClass(this.options.collapsedClass)?"expandItem":"collapseItem"](n)},expandItem:function(n){n.removeClass(this.options.collapsedClass)},collapseItem:function(n){var t=n.children(this.options.listNodeName);t.length&&n.addClass(this.options.collapsedClass)},expandAll:function(){var t=this;this.find(t.options.itemNodeName).each(function(){t.expandItem(n(this))})},collapseAll:function(){var t=this;this.find(t.options.itemNodeName).each(function(){t.collapseItem(n(this))})},setParent:function(n){n.children(this.options.listNodeName).length&&n.addClass("uk-parent")},unsetParent:function(n){n.removeClass("uk-parent "+this.options.collapsedClass);n.children(this.options.listNodeName).remove()},dragStart:function(t){var r=this.mouse,h=n(t.target),i=h.closest(this.options.itemNodeName),f=i.offset(),e,o,s;for(this.placeEl.css("height",i.height()),r.offsetX=t.pageX-f.left,r.offsetY=t.pageY-f.top,r.startX=r.lastX=f.left,r.startY=r.lastY=f.top,this.dragRootEl=this.element,this.dragEl=n(document.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass),this.dragEl.css("width",i.width()),this.tmpDragOnSiblings=[i[0].previousSibling,i[0].nextSibling],i.after(this.placeEl),i[0].parentNode.removeChild(i[0]),i.appendTo(this.dragEl),n(document.body).append(this.dragEl),this.dragEl.css({left:f.left,top:f.top}),s=this.dragEl.find(this.options.itemNodeName),e=0;e<s.length;e++)o=n(s[e]).parents(this.options.listNodeName).length,o>this.dragDepth&&(this.dragDepth=o);u.addClass(this.options.movingClass)},dragStop:function(){var n=this.dragEl.children(this.options.itemNodeName).first();n[0].parentNode.removeChild(n[0]);this.placeEl.replaceWith(n);this.dragEl.remove();(this.tmpDragOnSiblings[0]!=n[0].previousSibling||this.tmpDragOnSiblings[0]!=n[0].previousSibling)&&(this.element.trigger("nestable-change",[n,this.hasNewRoot?"added":"moved"]),this.hasNewRoot&&this.dragRootEl.trigger("nestable-change",[n,"removed"]));this.reset();u.removeClass(this.options.movingClass)},dragMove:function(t){var f,o,s,y,c,u=this.options,i=this.mouse,l,h,a,b;if(this.dragEl.css({left:t.pageX-i.offsetX,top:t.pageY-i.offsetY}),i.lastX=i.nowX,i.lastY=i.nowY,i.nowX=t.pageX,i.nowY=t.pageY,i.distX=i.nowX-i.lastX,i.distY=i.nowY-i.lastY,i.lastDirX=i.dirX,i.lastDirY=i.dirY,i.dirX=i.distX===0?0:i.distX>0?1:-1,i.dirY=i.distY===0?0:i.distY>0?1:-1,l=Math.abs(i.distX)>Math.abs(i.distY)?1:0,!i.moving){i.dirAx=l;i.moving=!0;return}if(i.dirAx!==l?(i.distAxX=0,i.distAxY=0):(i.distAxX+=Math.abs(i.distX),i.dirX!==0&&i.dirX!==i.lastDirX&&(i.distAxX=0),i.distAxY+=Math.abs(i.distY),i.dirY!==0&&i.dirY!==i.lastDirY&&(i.distAxY=0)),i.dirAx=l,i.dirAx&&i.distAxX>=u.threshold&&(i.distAxX=0,s=this.placeEl.prev(u.itemNodeName),i.distX>0&&s.length&&!s.hasClass(u.collapsedClass)&&(f=s.find(u.listNodeName).last(),c=this.placeEl.parents(u.listNodeName).length,c+this.dragDepth<=u.maxDepth&&(f.length?(f=s.children(u.listNodeName).last(),f.append(this.placeEl)):(f=n("<"+u.listNodeName+"/>").addClass(u.listClass),f.append(this.placeEl),s.append(f),this.setParent(s)))),i.distX<0&&(y=this.placeEl.next(u.itemNodeName),y.length||(o=this.placeEl.parent(),this.placeEl.closest(u.itemNodeName).after(this.placeEl),o.children().length||this.unsetParent(o.parent())))),h=!1,e||(this.dragEl[0].style.visibility="hidden"),this.pointEl=n(document.elementFromPoint(t.pageX-document.body.scrollLeft,t.pageY-(window.pageYOffset||document.documentElement.scrollTop))),e||(this.dragEl[0].style.visibility="visible"),this.pointEl.hasClass(u.handleClass)?this.pointEl=this.pointEl.closest(u.itemNodeName):(a=this.pointEl.closest("."+u.itemClass),a.length&&(this.pointEl=a.closest(u.itemNodeName))),this.pointEl.hasClass(u.emptyClass))h=!0;else if(this.pointEl.data("nestable")&&!this.pointEl.children().length)h=!0,this.pointEl=n(this.tplempty).appendTo(this.pointEl);else if(!this.pointEl.length||!this.pointEl.hasClass(u.listitemClass))return;var p=this.element,w=this.pointEl.closest("."+this.options.listBaseClass),v=p[0]!==this.pointEl.closest("."+this.options.listBaseClass)[0],k=w;if(!i.dirAx||v||h){if(v&&u.group!==k.data("nestable-group"))return;if(r.push(p),c=this.dragDepth-1+this.pointEl.parents(u.listNodeName).length,c>u.maxDepth)return;b=t.pageY<this.pointEl.offset().top+this.pointEl.height()/2;o=this.placeEl.parent();h?this.pointEl.replaceWith(this.placeEl):b?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl);o.children().length||o.data("nestable")||this.unsetParent(o.parent());this.dragRootEl.find(u.itemNodeName).length||this.dragRootEl.children().length||this.dragRootEl.append(this.tplempty);v&&(this.dragRootEl=w,this.hasNewRoot=this.element[0]!==this.dragRootEl[0])}}}),t.ready(function(i){n("[data-uk-nestable]",i).each(function(){var i=n(this),r;i.data("nestable")||(r=t.nestable(i,t.Utils.options(i.attr("data-uk-nestable"))))})}),t.nestable});
//# sourceMappingURL=nestable.min.js.map
