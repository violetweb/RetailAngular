/*! UIkit 2.10.0 | http://www.getuikit.com | (c) 2014 YOOtheme | MIT License */
(function(n){var t;jQuery&&jQuery.UIkit&&(t=n(jQuery,jQuery.UIkit));typeof define=="function"&&define.amd&&define("uikit-htmleditor",["uikit"],function(){return t||n(jQuery,jQuery.UIkit)})})(function(n,t){var i=[];return t.component("htmleditor",{defaults:{iframe:!1,mode:"split",markdown:!1,autocomplete:!0,height:500,maxsplitsize:1e3,markedOptions:{gfm:!0,tables:!0,breaks:!0,pedantic:!0,sanitize:!1,smartLists:!0,smartypants:!1,langPrefix:"lang-"},codemirror:{mode:"htmlmixed",lineWrapping:!0,dragDrop:!1,autoCloseTags:!0,matchTags:!0,autoCloseBrackets:!0,matchBrackets:!0,indentUnit:4,indentWithTabs:!1,tabSize:4,hintOptions:{completionSingle:!1}},toolbar:["bold","italic","strike","link","image","blockquote","listUl","listOl"],lblPreview:"Preview",lblCodeview:"HTML",lblMarkedview:"Markdown"},init:function(){var r=this,u=t.components.htmleditor.template;this.CodeMirror=this.options.CodeMirror||CodeMirror;this.buttons={};u=u.replace(/\{:lblPreview\}/g,this.options.lblPreview);u=u.replace(/\{:lblCodeview\}/g,this.options.lblCodeview);this.htmleditor=n(u);this.content=this.htmleditor.find(".uk-htmleditor-content");this.toolbar=this.htmleditor.find(".uk-htmleditor-toolbar");this.preview=this.htmleditor.find(".uk-htmleditor-preview").children().eq(0);this.code=this.htmleditor.find(".uk-htmleditor-code");this.element.before(this.htmleditor).appendTo(this.code);this.editor=this.CodeMirror.fromTextArea(this.element[0],this.options.codemirror);this.editor.htmleditor=this;this.editor.on("change",t.Utils.debounce(function(){r.render()},150));this.editor.on("change",function(){r.editor.save()});this.code.find(".CodeMirror").css("height",this.options.height);this.options.iframe?(this.iframe=n('<iframe class="uk-htmleditor-iframe" frameborder="0" scrolling="auto" height="100" width="100%"><\/iframe>'),this.preview.append(this.iframe),this.iframe[0].contentWindow.document.open(),this.iframe[0].contentWindow.document.close(),this.preview.container=n(this.iframe[0].contentWindow.document).find("body"),typeof this.options.iframe=="string"&&this.preview.container.parent().append('<link rel="stylesheet" href="'+this.options.iframe+'">')):this.preview.container=this.preview;t.$win.on("resize",t.Utils.debounce(function(){r.fit()},200));var f=this.iframe?this.preview.container:r.preview.parent(),o=this.code.find(".CodeMirror-sizer"),e=this.code.find(".CodeMirror-scroll").on("scroll",t.Utils.debounce(function(){if(r.htmleditor.attr("data-mode")!="tab"){var n=o.height()-e.height(),t=f[0].scrollHeight-(r.iframe?r.iframe.height():f.height()),i=t/n,u=e.scrollTop()*i;f.scrollTop(u)}},10));this.htmleditor.on("click",".uk-htmleditor-button-code, .uk-htmleditor-button-preview",function(t){t.preventDefault();r.htmleditor.attr("data-mode")=="tab"&&(r.htmleditor.find(".uk-htmleditor-button-code, .uk-htmleditor-button-preview").removeClass("uk-active").filter(this).addClass("uk-active"),r.activetab=n(this).hasClass("uk-htmleditor-button-code")?"code":"preview",r.htmleditor.attr("data-active-tab",r.activetab),r.editor.refresh())});this.htmleditor.on("click","a[data-htmleditor-button]",function(){r.code.is(":visible")&&r.trigger("action."+n(this).data("htmleditor-button"),[r.editor])});if(this.preview.parent().css("height",this.code.height()),this.options.autocomplete&&this.CodeMirror.showHint&&this.CodeMirror.hint&&this.CodeMirror.hint.html)this.editor.on("inputRead",t.Utils.debounce(function(){var i=r.editor.getDoc(),u=i.getCursor(),f=r.CodeMirror.innerMode(r.editor.getMode(),r.editor.getTokenAt(u).state).mode.name,t,n;f=="xml"&&(t=r.editor.getCursor(),n=r.editor.getTokenAt(t),(n.string.charAt(0)=="<"||n.type=="attribute")&&r.CodeMirror.showHint(r.editor,r.CodeMirror.hint.html,{completeSingle:!1}))},100));this.debouncedRedraw=t.Utils.debounce(function(){r.redraw()},5);this.on("init",function(){r.redraw()});this.element.attr("data-uk-check-display",1).on("uk-check-display",function(){this.htmleditor.is(":visible")&&this.fit()}.bind(this));i.push(this)},addButton:function(n,t){this.buttons[n]=t},addButtons:function(t){n.extend(this.buttons,t)},replaceInPreview:function(n,t){function f(n){var t=r.getValue().substring(0,n).split("\n");return{line:t.length-1,ch:t[t.length-1].length}}var r=this.editor,u=[],e=r.getValue(),i=-1;return this.currentvalue=this.currentvalue.replace(n,function(){i=e.indexOf(arguments[0],++i);var n={matches:arguments,from:f(i),to:f(i+arguments[0].length),replace:function(t){r.replaceRange(t,n.from,n.to)},inRange:function(t){return t.line===n.from.line&&t.line===n.to.line?t.ch>=n.from.ch&&t.ch<n.to.ch:t.line===n.from.line&&t.ch>=n.from.ch||t.line>n.from.line&&t.line<n.to.line||t.line===n.to.line&&t.ch<n.to.ch}},o=t(n);return o==!1?arguments[0]:(u.push(n),o)}),u},_buildtoolbar:function(){if(this.options.toolbar&&this.options.toolbar.length){var n=this,t=[];this.toolbar.empty();this.options.toolbar.forEach(function(i){if(n.buttons[i]){var r=n.buttons[i].title?n.buttons[i].title:i;t.push('<li><a data-htmleditor-button="'+i+'" title="'+r+'" data-uk-tooltip>'+n.buttons[i].label+"<\/a><\/li>")}});this.toolbar.html(t.join("\n"))}},fit:function(){var n=this.options.mode;n=="split"&&this.htmleditor.width()<this.options.maxsplitsize&&(n="tab");n=="tab"&&(this.activetab||(this.activetab="code",this.htmleditor.attr("data-active-tab",this.activetab)),this.htmleditor.find(".uk-htmleditor-button-code, .uk-htmleditor-button-preview").removeClass("uk-active").filter(this.activetab=="code"?".uk-htmleditor-button-code":".uk-htmleditor-button-preview").addClass("uk-active"));this.editor.refresh();this.preview.parent().css("height",this.code.height());this.htmleditor.attr("data-mode",n)},redraw:function(){this._buildtoolbar();this.render();this.fit()},getMode:function(){return this.editor.getOption("mode")},getCursorMode:function(){var n={mode:"html"};return this.trigger("cursorMode",[n]),n.mode},render:function(){if(this.currentvalue=this.editor.getValue(),!this.currentvalue){this.element.val("");this.preview.container.html("");return}this.trigger("render",[this]);this.trigger("renderLate",[this]);this.preview.container.html(this.currentvalue)},addShortcut:function(t,i){var r={};return n.isArray(t)||(t=[t]),t.forEach(function(n){r[n]=i}),this.editor.addKeyMap(r),r},addShortcutAction:function(n,t){var i=this;this.addShortcut(t,function(){i.element.trigger("action."+n,[i.editor])})},replaceSelection:function(n){var f=this.editor.getSelection(),e,o;if(!f.length){for(var r=this.editor.getCursor(),u=this.editor.getLine(r.line),t=r.ch,i=t;i<u.length&&/[\w$]+/.test(u.charAt(i));)++i;while(t&&/[\w$]+/.test(u.charAt(t-1)))--t;e=t!=i&&u.slice(t,i);e&&(this.editor.setSelection({line:r.line,ch:t},{line:r.line,ch:i}),f=e)}o=n.replace("$1",f);this.editor.replaceSelection(o,"end");this.editor.focus()},replaceLine:function(n){var t=this.editor.getDoc().getCursor(),i=this.editor.getLine(t.line),r=n.replace("$1",i);this.editor.replaceRange(r,{line:t.line,ch:0},{line:t.line,ch:i.length});this.editor.setCursor({line:t.line,ch:r.length});this.editor.focus()},save:function(){this.editor.save()}}),t.components.htmleditor.template='<div class="uk-htmleditor uk-clearfix" data-mode="split"><div class="uk-htmleditor-navbar"><ul class="uk-htmleditor-navbar-nav uk-htmleditor-toolbar"><\/ul><div class="uk-htmleditor-navbar-flip"><ul class="uk-htmleditor-navbar-nav"><li class="uk-htmleditor-button-code"><a>{:lblCodeview}<\/a><\/li><li class="uk-htmleditor-button-preview"><a>{:lblPreview}<\/a><\/li><li><a data-htmleditor-button="fullscreen"><i class="uk-icon-expand"><\/i><\/a><\/li><\/ul><\/div><\/div><div class="uk-htmleditor-content"><div class="uk-htmleditor-code"><\/div><div class="uk-htmleditor-preview"><div><\/div><\/div><\/div><\/div>',t.plugin("htmleditor","base",{init:function(n){function i(t,i,r){n.on("action."+t,function(){n.getCursorMode()=="html"&&n[r=="replaceLine"?"replaceLine":"replaceSelection"](i)})}n.addButtons({fullscreen:{title:"Fullscreen",label:'<i class="uk-icon-expand"><\/i>'},bold:{title:"Bold",label:'<i class="uk-icon-bold"><\/i>'},italic:{title:"Italic",label:'<i class="uk-icon-italic"><\/i>'},strike:{title:"Strikethrough",label:'<i class="uk-icon-strikethrough"><\/i>'},blockquote:{title:"Blockquote",label:'<i class="uk-icon-quote-right"><\/i>'},link:{title:"Link",label:'<i class="uk-icon-link"><\/i>'},image:{title:"Image",label:'<i class="uk-icon-picture-o"><\/i>'},listUl:{title:"Unordered List",label:'<i class="uk-icon-list-ul"><\/i>'},listOl:{title:"Ordered List",label:'<i class="uk-icon-list-ol"><\/i>'}});i("bold","<strong>$1<\/strong>");i("italic","<em>$1<\/em>");i("strike","<del>$1<\/del>");i("blockquote","<blockquote><p>$1<\/p><\/blockquote>","replaceLine");i("link",'<a href="http://">$1<\/a>');i("image",'<img src="http://" alt="$1">');var r=function(){var i;if(n.getCursorMode()=="html"){var t=n.editor,u=t.getDoc().getCursor(!0),r=t.getDoc().getCursor(!1);for(i=u.line;i<r.line+1;i++)t.replaceRange("<li>"+t.getLine(i)+"<\/li>",{line:i,ch:0},{line:i,ch:t.getLine(i).length});t.setCursor({line:r.line,ch:t.getLine(r.line).length});t.focus()}};n.on("action.listUl",function(){r()});n.on("action.listOl",function(){r()});n.htmleditor.on("click",'a[data-htmleditor-button="fullscreen"]',function(){var i,r;n.htmleditor.toggleClass("uk-htmleditor-fullscreen");i=n.editor.getWrapperElement();n.htmleditor.hasClass("uk-htmleditor-fullscreen")?(n.editor.state.fullScreenRestore={scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset,width:i.style.width,height:i.style.height},i.style.width="",i.style.height=n.content.height()+"px",document.documentElement.style.overflow="hidden"):(document.documentElement.style.overflow="",r=n.editor.state.fullScreenRestore,i.style.width=r.width,i.style.height=r.height,window.scrollTo(r.scrollLeft,r.scrollTop));setTimeout(function(){n.fit();t.$win.trigger("resize")},50)});n.addShortcut(["Ctrl-S","Cmd-S"],function(){n.element.trigger("htmleditor-save",[n])});n.addShortcutAction("bold",["Ctrl-B","Cmd-B"])}}),t.plugin("htmleditor","markdown",{init:function(t){function u(){t.editor.setOption("mode","gfm");t.htmleditor.find(".uk-htmleditor-button-code a").html(t.options.lblMarkedview)}function i(n,i,r){t.on("action."+n,function(){t.getCursorMode()=="markdown"&&t[r=="replaceLine"?"replaceLine":"replaceSelection"](i)})}var r=t.options.marked||marked;if(r){r.setOptions(t.options.markedOptions);t.options.markdown&&u();i("bold","**$1**");i("italic","*$1*");i("strike","~~$1~~");i("blockquote","> $1","replaceLine");i("link","[$1](http://)");i("image","![$1](http://)");t.on("action.listUl",function(){var i;if(t.getCursorMode()=="markdown"){var n=t.editor,u=n.getDoc().getCursor(!0),r=n.getDoc().getCursor(!1);for(i=u.line;i<r.line+1;i++)n.replaceRange("* "+n.getLine(i),{line:i,ch:0},{line:i,ch:n.getLine(i).length});n.setCursor({line:r.line,ch:n.getLine(r.line).length});n.focus()}});t.on("action.listOl",function(){var e,o,i;if(t.getCursorMode()=="markdown"){var n=t.editor,r=n.getDoc().getCursor(!0),u=n.getDoc().getCursor(!1),f=1;for(r.line>0&&(e=n.getLine(r.line-1),(o=e.match(/^(\d+)\./))&&(f=Number(o[1])+1)),i=r.line;i<u.line+1;i++)n.replaceRange(f+". "+n.getLine(i),{line:i,ch:0},{line:i,ch:n.getLine(i).length}),f++;n.setCursor({line:u.line,ch:n.getLine(u.line).length});n.focus()}});t.on("renderLate",function(){t.editor.options.mode=="gfm"&&(t.currentvalue=r(t.currentvalue))});t.on("cursorMode",function(n,i){if(t.editor.options.mode=="gfm"){var r=t.editor.getDoc().getCursor();t.editor.getTokenAt(r).state.base.htmlState||(i.mode="markdown")}});n.extend(t,{enableMarkdown:function(){u();this.render()},disableMarkdown:function(){this.editor.setOption("mode","htmlmixed");this.htmleditor.find(".uk-htmleditor-button-code a").html(this.options.lblCodeview);this.render()}});t.on({enableMarkdown:function(){t.enableMarkdown()},disableMarkdown:function(){t.disableMarkdown()}})}}}),n(function(){n("textarea[data-uk-htmleditor]").each(function(){var i=n(this),r;i.data("htmleditor")||(r=t.htmleditor(i,t.Utils.options(i.attr("data-uk-htmleditor"))))})}),t.htmleditor});
//# sourceMappingURL=htmleditor.min.js.map
