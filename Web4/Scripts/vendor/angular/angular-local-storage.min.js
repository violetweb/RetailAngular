/**
 * An Angular module that gives you access to the browsers local storage
 * @version v0.1.5 - 2015-03-21
 * @link https://github.com/grevory/angular-local-storage
 * @author grevory <greg@gregpike.ca>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
(function(n,t){"use strict";function c(n){return/^-?\d+\.?\d*$/.test(n.replace(/["']/g,""))}var s=t.isDefined,r=t.isUndefined,u=t.isNumber,i=t.isObject,f=t.isArray,h=t.extend,e=t.toJson,o=t.fromJson,l=t.module("LocalStorageModule",[]);l.provider("localStorageService",function(){this.prefix="ls";this.storageType="localStorage";this.cookie={expiry:30,path:"/"};this.notify={setItem:!0,removeItem:!1};this.setPrefix=function(n){return this.prefix=n,this};this.setStorageType=function(n){return this.storageType=n,this};this.setStorageCookie=function(n,t){return this.cookie.expiry=n,this.cookie.path=t,this};this.setStorageCookieDomain=function(n){return this.cookie.domain=n,this};this.setNotify=function(n,t){return this.notify={setItem:n,removeItem:t},this};this.$get=["$rootScope","$window","$document","$parse",function(n,t,l,a){var y=this,v=y.prefix,d=y.cookie,nt=y.notify,k=y.storageType,p;l?l[0]&&(l=l[0]):l=document;v.substr(-1)!=="."&&(v=!v?"":v+".");var b=function(n){return v+n},w=function(){try{var i=k in t&&t[k]!==null,r=b("__"+Math.round(Math.random()*1e7));return i&&(p=t[k],p.setItem(r,""),p.removeItem(r)),i}catch(u){return k="cookie",n.$broadcast("LocalStorageModule.notification.error",u.message),!1}}(),it=function(t,o){if(r(o)?o=null:(i(o)||f(o)||u(+o||o))&&(o=e(o)),!w||y.storageType==="cookie")return w||n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),nt.setItem&&n.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:o,storageType:"cookie"}),g(t,o);try{p&&p.setItem(b(t),o);nt.setItem&&n.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:o,storageType:y.storageType})}catch(s){return n.$broadcast("LocalStorageModule.notification.error",s.message),g(t,o)}return!0},ft=function(t){if(!w||y.storageType==="cookie")return w||n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),ot(t);var i=p?p.getItem(b(t)):null;return!i||i==="null"?null:i.charAt(0)==="{"||i.charAt(0)==="["||c(i)?o(i):i},et=function(t){if(!w||y.storageType==="cookie")return w||n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),nt.removeItem&&n.$broadcast("LocalStorageModule.notification.removeitem",{key:t,storageType:"cookie"}),tt(t);try{p.removeItem(b(t));nt.removeItem&&n.$broadcast("LocalStorageModule.notification.removeitem",{key:t,storageType:y.storageType})}catch(i){return n.$broadcast("LocalStorageModule.notification.error",i.message),tt(t)}return!0},st=function(){var t,i,r;if(!w)return n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;t=v.length;i=[];for(r in p)if(r.substr(0,t)===v)try{i.push(r.substr(t))}catch(u){return n.$broadcast("LocalStorageModule.notification.error",u.Description),[]}return i},ht=function(t){var u=!v?new RegExp:new RegExp("^"+v),f=!t?new RegExp:new RegExp(t),r,i;if(!w||y.storageType==="cookie")return w||n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),ut();r=v.length;for(i in p)if(u.test(i)&&f.test(i.substr(r)))try{et(i.substr(r))}catch(e){return n.$broadcast("LocalStorageModule.notification.error",e.message),ut()}return!0},rt=function(){try{return t.navigator.cookieEnabled||"cookie"in l&&(l.cookie.length>0||(l.cookie="test").indexOf.call(l.cookie,"test")>-1)}catch(i){return n.$broadcast("LocalStorageModule.notification.error",i.message),!1}}(),g=function(t,o,s){var v;if(r(o))return!1;if((f(o)||i(o))&&(o=e(o)),!rt)return n.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var c="",h=new Date,a="";o===null?(h.setTime(h.getTime()+-864e5),c="; expires="+h.toGMTString(),o=""):u(s)&&s!==0?(h.setTime(h.getTime()+s*864e5),c="; expires="+h.toGMTString()):d.expiry!==0&&(h.setTime(h.getTime()+d.expiry*864e5),c="; expires="+h.toGMTString());!t||(v="; path="+d.path,d.domain&&(a="; domain="+d.domain),l.cookie=b(t)+"="+encodeURIComponent(o)+c+v+a)}catch(y){return n.$broadcast("LocalStorageModule.notification.error",y.message),!1}return!0},ot=function(t){var u,r,i,f,e;if(!rt)return n.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(u=l.cookie&&l.cookie.split(";")||[],r=0;r<u.length;r++){for(i=u[r];i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(b(t)+"=")===0){f=decodeURIComponent(i.substring(v.length+t.length+1,i.length));try{return e=JSON.parse(f),o(e)}catch(s){return f}}}return null},tt=function(n){g(n,null)},ut=function(){for(var r,n=null,u=v.length,i=l.cookie.split(";"),t=0;t<i.length;t++){for(n=i[t];n.charAt(0)===" ";)n=n.substring(1,n.length);r=n.substring(u,n.indexOf("="));tt(r)}},ct=function(){return k},lt=function(n,t,r,u){u=u||t;var f=ft(u);return f===null&&s(r)?f=r:i(f)&&i(r)&&(f=h(r,f)),a(t).assign(n,f),n.$watch(t,function(n){it(u,n)},i(n[t]))},at=function(){for(var i=0,r=t[k],n=0;n<r.length;n++)r.key(n).indexOf(v)===0&&i++;return i};return{isSupported:w,getStorageType:ct,set:it,add:it,get:ft,keys:st,remove:et,clearAll:ht,bind:lt,deriveKey:b,length:at,cookie:{isSupported:rt,set:g,add:g,get:ot,remove:tt,clearAll:ut}}}]})})(window,window.angular);
//# sourceMappingURL=angular-local-storage.min.js.map
